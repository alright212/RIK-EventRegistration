@using System.Linq
@model EventRegistration.Application.EventDetailViewModel
@{
    ViewData["Title"] = "Osavõtjad";
}

<div class="px-4 py-3">
    @* Header section with image and title *@
    <div class="flex mb-4 h-16">
        <div class="flex w-full">
            <div class="w-1/3 main-blue-bg text-white flex items-center p-3 sm:p-4">
                <h1 class="text-xl sm:text-2xl font-bold m-0">Osavõtjad</h1>
            </div>
            <div class="w-2/3">
                <img src="~/images/osalejad.png" alt="Osavõtjate päis" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x300/a0aec0/ffffff?text=Image';" />
            </div>
        </div>
    </div>

    <div class="bg-white p-4 sm:p-6">
        @* Event Information section *@
        <div class="mb-4">
            <h2 class="text-lg font-bold">@Model.Event.Name</h2>
            <div class="text-sm text-gray-600">
                <p><strong>Toimumisaeg:</strong> @Model.Event.EventTime.ToString("dd.MM.yyyy")</p>
                <p><strong>Koht:</strong> @Model.Event.Location</p>
            </div>
        </div>

        <h3 class="font-bold text-md mb-2">Osavõtjad:</h3>
        
        @* Participant List *@
        @if (Model.Participants != null && Model.Participants.Any())
        {
            <div class="space-y-2">
                @foreach (var (participant, index) in Model.Participants.Select((p, i) => (p, i + 1)))
                {
                    <div class="grid grid-cols-12 gap-x-4 items-center border-b py-2">
                        <div class="col-span-1 text-right">@index.</div>
                        <div class="col-span-5 font-semibold">
                            @if (participant.ParticipantType == "Individual")
                            {
                                @participant.FirstName @participant.LastName
                            }
                            else
                            {
                                @participant.LegalName
                            }
                        </div>
                        <div class="col-span-3 text-gray-500">
                            @if (participant.ParticipantType == "Individual")
                            {
                                @participant.PersonalIdCode
                            }
                            else
                            {
                                @participant.RegistryCode
                            }
                        </div>
                        <div class="col-span-3 flex justify-end space-x-2">
                            <a asp-controller="Participants" asp-action="Details" asp-route-eventId="@Model.Event.Id" asp-route-participantId="@participant.ParticipantId" class="text-blue-600 hover:underline text-sm">VAATA</a>
                            <form asp-controller="Participants" asp-action="Delete" asp-route-eventId="@Model.Event.Id" asp-route-participantId="@participant.ParticipantId" method="post" onsubmit="return confirm('Kas olete kindel, et soovite selle osavõtja kustutada?');" style="display: inline;">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="text-red-600 hover:underline text-sm">KUSTUTA</button>
                            </form>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-center text-gray-500 py-4">Osavõtjaid ei ole veel lisatud.</p>
        }

        <hr class="my-6"/>

        @* Add new participant button *@
        <div>
            <h3 class="text-lg font-bold mb-4">Osavõtjate lisamine</h3>
            <a asp-controller="Participants" asp-action="Add" asp-route-eventId="@Model.Event.Id" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Lisa uus osavõtja</a>
        </div>
    </div>
</div>
